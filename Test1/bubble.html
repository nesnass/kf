<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>d3.js concept browser - ramblings.mcpher.com</title>
    <base href="https://storage.googleapis.com/xliberation.com/" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <link rel="stylesheet" type="text/css" href="cdn/css/d3direct.css" />
    <script type="text/javascript" src="https://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>

    <script type="text/javascript">
      google.load("jquery", "1");
      google.setOnLoadCallback(function() {
        initialize().then(function(control) {
          doTheTreeViz(control);
        });
      });

      function doTheTreeViz(control) {
        var svg = control.svg;

        var force = control.force;
        force
          .nodes(control.nodes)
          .links(control.links)
          .start();

        // Update the links
        var link = svg.selectAll("line.link").data(control.links, function(d) {
          return d.key;
        });

        // Enter any new links
        var linkEnter = link
          .enter()
          .insert("svg:line", ".node")
          .attr("class", "link")
          .attr("x1", function(d) {
            return d.source.x;
          })
          .attr("y1", function(d) {
            return d.source.y;
          })
          .attr("x2", function(d) {
            return d.target.x;
          })
          .attr("y2", function(d) {
            return d.target.y;
          })
          .append("svg:title")
          .text(function(d) {
            return d.target.name + ":" + d.source.name;
          });

        // Exit any old links.
        link.exit().remove();

        // Update the nodes
        var node = svg.selectAll("g.node").data(control.nodes, function(d) {
          return d.key;
        });

        node
          .select("circle")
          .style("fill", function(d) {
            return getColor(d);
          })
          .attr("r", function(d) {
            return getRadius(d);
          });

        // Enter any new nodes.
        var nodeEnter = node
          .enter()
          .append("svg:g")
          .attr("class", "node")
          .attr("transform", function(d) {
            return "translate(" + d.x + "," + d.y + ")";
          })
          .on("dblclick", function(d) {
            control.nodeClickInProgress = false;
            if (d.url) window.open(d.url);
          })
          .on("click", function(d) {
            // this is a hack so that click doesnt fire on the1st click of a dblclick
            if (!control.nodeClickInProgress) {
              control.nodeClickInProgress = true;
              setTimeout(function() {
                if (control.nodeClickInProgress) {
                  control.nodeClickInProgress = false;
                  if (control.options.nodeFocus) {
                    d.isCurrentlyFocused = !d.isCurrentlyFocused;
                    doTheTreeViz(makeFilteredData(control));
                  }
                }
              }, control.clickHack);
            }
          })
          .call(force.drag);

        nodeEnter
          .append("svg:circle")
          .attr("r", function(d) {
            return getRadius(d);
          })
          .style("fill", function(d) {
            return getColor(d);
          })
          .on("mouseover", function(d) {
            // enhance all the links that end here
            enhanceNode(d);
          })

          .on("mouseout", function(d) {
            resetNode(d);
          })
          .append("svg:title")
          .text(function(d) {
            return d[control.options.nodeLabel];
          });

        function enhanceNode(selectedNode) {
          link
            .filter(function(d) {
              return (
                d.source.key == selectedNode.key ||
                d.target.key == selectedNode.key
              );
            })
            .style("stroke", control.options.routeFocusStroke)
            .style("stroke-width", control.options.routeFocusStrokeWidth);

          if (text) {
            text
              .filter(function(d) {
                return areWeConnected(selectedNode, d);
              })
              .style("fill", control.options.routeFocusStroke);
          }
        }

        function areWeConnected(node1, node2) {
          for (var i = 0; i < control.data.links.length; i++) {
            var lnk = control.data.links[i];
            if (
              (lnk.source.key === node1.key && lnk.target.key === node2.key) ||
              (lnk.source.key === node2.key && lnk.target.key === node1.key)
            )
              return lnk;
          }
          return null;
        }
        function resetNode(selectedNode) {
          link
            .style("stroke", control.options.routeStroke)
            .style("stroke-width", control.options.routeStrokeWidth);
          if (text) {
            text.style("fill", control.options.routeStroke);
          }
        }

        if (control.options.nodeLabel) {
          // text is done once for shadow as well as for text
          var textShadow = nodeEnter
            .append("svg:text")
            .attr("x", function(d) {
              var x =
                d.right || !d.fixed
                  ? control.options.labelOffset
                  : -d.dim.width - control.options.labelOffset;
              return x;
            })
            .attr("dy", ".31em")
            .attr("class", "shadow")
            .attr("text-anchor", function(d) {
              return !d.right ? "start" : "start";
            })
            .style("font-size", control.options.labelFontSize + "px")
            .text(function(d) {
              return d.shortName ? d.shortName : d.name;
            });

          var text = nodeEnter
            .append("svg:text")
            .attr("x", function(d) {
              var x =
                d.right || !d.fixed
                  ? control.options.labelOffset
                  : -d.dim.width - control.options.labelOffset;
              return x;
            })
            .attr("dy", ".35em")
            .attr("class", "text")
            .attr("text-anchor", function(d) {
              return !d.right ? "start" : "start";
            })
            .style("font-size", control.options.labelFontSize + "px")
            .text(function(d) {
              return d.shortName ? d.shortName : d.name;
            })

            .on("mouseover", function(d) {
              // enhance all the links that end here
              enhanceNode(d);
              d3.select(this).style("fill", control.options.routeFocusStroke);
            })

            .on("mouseout", function(d) {
              resetNode(d);
            });
        }

        // Exit any old nodes.
        node.exit().remove();
        control.link = svg.selectAll("line.link");
        control.node = svg.selectAll("g.node");
        force.on("tick", tick);

        if (control.options.linkName) {
          link.append("title").text(function(d) {
            return d[control.options.linkName];
          });
        }

        function tick() {
          link
            .attr("x1", function(d) {
              return d.source.x;
            })
            .attr("y1", function(d) {
              return d.source.y;
            })
            .attr("x2", function(d) {
              return d.target.x;
            })
            .attr("y2", function(d) {
              return d.target.y;
            });
          node.attr("transform", function(d) {
            return "translate(" + d.x + "," + d.y + ")";
          });
        }

        function getRadius(d) {
          return makeRadius(control, d);
        }
        function getColor(d) {
          return control.options.nodeFocus && d.isCurrentlyFocused
            ? control.options.nodeFocusColor
            : control.color(d.group);
        }
      }

      function makeRadius(control, d) {
        var r =
          control.options.radius *
          (control.options.nodeResize
            ? Math.sqrt(d[control.options.nodeResize]) / Math.PI
            : 1);
        return control.options.nodeFocus && d.isCurrentlyFocused
          ? control.options.nodeFocusRadius
          : r;
      }

      function makeFilteredData(control, selectedNode) {
        // we'll keep only the data where filterned nodes are the source or target
        var newNodes = [];
        var newLinks = [];

        for (var i = 0; i < control.data.links.length; i++) {
          var link = control.data.links[i];
          if (
            link.target.isCurrentlyFocused ||
            link.source.isCurrentlyFocused
          ) {
            newLinks.push(link);
            addNodeIfNotThere(link.source, newNodes);
            addNodeIfNotThere(link.target, newNodes);
          }
        }
        // if none are selected reinstate the whole dataset
        if (newNodes.length > 0) {
          control.links = newLinks;
          control.nodes = newNodes;
        } else {
          control.nodes = control.data.nodes;
          control.links = control.data.links;
        }
        return control;

        function addNodeIfNotThere(node, nodes) {
          for (var i = 0; i < nodes.length; i++) {
            if (nodes[i].key == node.key) return i;
          }
          return nodes.push(node) - 1;
        }
      }

      function getPixelDims(scratch, t) {
        // scratch is an elemen with the correct styling, t is the text to be counted in pixels
        scratch.empty();
        scratch.append(document.createTextNode(t));
        return { width: scratch.outerWidth(), height: scratch.outerHeight() };
      }
      function initialize() {
        var initPromise = $.Deferred();
        var control = {};
        control.divName = "#chart";

        //some basic options
        var newoptions = {
          nodeLabel: "label",
          nodeResize: "count",
          height: 900,
          nodeFocus: true,
          radius: 3,
          charge: -500
        };
        // defaults
        control.options = $.extend(
          {
            stackHeight: 12,
            radius: 5,
            fontSize: 14,
            labelFontSize: 8,
            labelLineSpacing: 2.5,
            nodeLabel: null,
            markerWidth: 0,
            markerHeight: 0,
            width: $(control.divName).outerWidth(),
            gap: 1.5,
            nodeResize: "",
            linkDistance: 80,
            charge: -120,
            styleColumn: null,
            styles: null,
            linkName: null,
            nodeFocus: true,
            nodeFocusRadius: 25,
            nodeFocusColor: "FireBrick",
            labelOffset: 5,
            gravity: 0.05,
            routeFocusStroke: "FireBrick",
            routeFocusStrokeWidth: 3,
            circleFill: "Black",
            routeStroke: "Black",
            nodeColor: "white",
            routeStrokeWidth: 1,
            height: $(control.divName).outerHeight()
          },
          newoptions
        );

        var options = control.options;
        options.gap = options.gap * options.radius;
        control.width = options.width;
        control.height = options.height;
        // this is an element that can be used to determine the width of a text label

        control.scratch = $(document.createElement("span"))
          .addClass("shadow")
          .css("display", "none")
          .css("font-size", control.options.labelFontSize + "px");
        $("body").append(control.scratch);

        getTheData(control).then(function(data) {
          control.data = data;
          control.nodes = data.nodes;
          control.links = data.links;
          control.color = d3.scale.category20();
          control.clickHack = 200;

          control.svg = d3
            .select(control.divName)
            .append("svg:svg")
            .attr("width", control.width)
            .attr("height", control.height);

          control.force = d3.layout
            .force()
            .size([control.width, control.height])
            .linkDistance(control.options.linkDistance)
            .charge(control.options.charge)
            .gravity(control.options.gravity);

          initPromise.resolve(control);
        });
        return initPromise.promise();
      }

      var mydata = [
        {
          name: "addons",
          count: 2,
          key: "addons",
          pages: [
            {
              name: "A year in apps script and my bucket list",
              key: "4478459723408930641",
              title: "A year in apps script and my bucket list",
              url:
                "http://excelramblings.blogspot.com/2015/01/a-year-in-apps-script-and-my-bucket-list.html"
            },
            {
              name: "A year in apps script and my bucket list",
              key: "4478459723408930641",
              title: "A year in apps script and my bucket list",
              url:
                "http://excelramblings.blogspot.com/2015/01/a-year-in-apps-script-and-my-bucket-list.html"
            }
          ]
        },
        {
          name: "apis",
          count: 72,
          key: "apis",
          pages: [
            {
              name: "2016 - Another year in Apps Script",
              key: "919444871561675608",
              title: "2016 - Another year in Apps Script",
              url:
                "http://excelramblings.blogspot.com/2016/12/2016-another-year-in-apps-script.html"
            },
            {
              name: "A belated post - 2015 - a year in Apps Script",
              key: "7187713383195054941",
              title: "A belated post - 2015 - a year in Apps Script",
              url:
                "http://excelramblings.blogspot.com/2016/03/a-belated-post-2015-year-in-apps-script.html"
            },
            {
              name:
                "Parse.com as a substitute for ScriptDB in Google Apps Script",
              key: "7001401762815725863",
              title:
                "Parse.com as a substitute for ScriptDB in Google Apps Script",
              url:
                "http://excelramblings.blogspot.com/2014/05/parsecom-as-substitute-for-scriptdb-in.html"
            },
            {
              name:
                "Eurovision song contest voting oddities - interactive visualization",
              key: "3387730798287808432",
              title:
                "Eurovision song contest voting oddities - interactive visualization",
              url:
                "http://excelramblings.blogspot.com/2014/05/eurovision-song-contest-voting-oddities.html"
            },
            {
              name: "Dealing with Unix timestamps in Excel",
              key: "3060013286872872681",
              title: "Dealing with Unix timestamps in Excel",
              url:
                "http://excelramblings.blogspot.com/2013/12/dealing-with-unix-timestamps-in-excel.html"
            },
            {
              name: "Tracking your Excel Workbooks with Google Analytics",
              key: "8719756569439397730",
              title: "Tracking your Excel Workbooks with Google Analytics",
              url:
                "http://excelramblings.blogspot.com/2013/11/tracking-your-excel-workbooks-with.html"
            },
            {
              name: "Mitigating for changes in REST API rules and formats",
              key: "6535599039394459349",
              title: "Mitigating for changes in REST API rules and formats",
              url:
                "http://excelramblings.blogspot.com/2013/11/mitigating-for-changes-in-rest-api.html"
            },
            {
              name: "XML and JSON conversion in VBA ",
              key: "8631701126612541596",
              title: "XML and JSON conversion in VBA ",
              url:
                "http://excelramblings.blogspot.com/2013/10/xml-and-json-conversion-in-vba.html"
            },
            {
              name:
                "REST access to list management cloud based functions - plus a VBA example",
              key: "9125639579444215862",
              title:
                "REST access to list management cloud based functions - plus a VBA example",
              url:
                "http://excelramblings.blogspot.com/2013/09/rest-access-to-list-management-cloud.html"
            },
            {
              name: "What does Google Autocomplete show all over the world ?",
              key: "8388159511072830347",
              title: "What does Google Autocomplete show all over the world ?",
              url:
                "http://excelramblings.blogspot.com/2013/08/what-does-google-autocomplete-show-all.html"
            },
            {
              name: "Google Docs to Excel Asynchronously",
              key: "6143895170557586170",
              title: "Google Docs to Excel Asynchronously",
              url:
                "http://excelramblings.blogspot.com/2013/08/google-docs-to-excel-asynchronously.html"
            },
            {
              name:
                "Using ScriptDB as a noSQL database for non-Google Apps Script clients",
              key: "4984756556960647894",
              title:
                "Using ScriptDB as a noSQL database for non-Google Apps Script clients",
              url:
                "http://excelramblings.blogspot.com/2013/07/using-scriptdb-as-nosql-database-for.html"
            },
            {
              name: "Concept browser for site navigation with d3",
              key: "2591807608450374884",
              title: "Concept browser for site navigation with d3",
              url:
                "http://excelramblings.blogspot.com/2013/07/concept-browser-for-site-navigation.html"
            },
            {
              name: "Sankey diagrams direct from Excel - update",
              key: "7899286130266944386",
              title: "Sankey diagrams direct from Excel - update",
              url:
                "http://excelramblings.blogspot.com/2013/07/sankey-diagrams-direct-from-excel-update.html"
            },
            {
              name:
                "Exploring blogs and sites by d3 tag visualization and effect on site visits",
              key: "7778365833610693391",
              title:
                "Exploring blogs and sites by d3 tag visualization and effect on site visits",
              url:
                "http://excelramblings.blogspot.com/2013/06/exploring-blogs-and-sites-by-d3-tag.html"
            },
            {
              name:
                "Google Fusion Big Data and D3 integration: flight data visualization",
              key: "8192496343933999913",
              title:
                "Google Fusion Big Data and D3 integration: flight data visualization",
              url:
                "http://excelramblings.blogspot.com/2013/06/google-fusion-big-data-and-d3.html"
            },
            {
              name: "jQuery promises and exponential backoff",
              key: "9187220054075379583",
              title: "jQuery promises and exponential backoff",
              url:
                "http://excelramblings.blogspot.com/2013/06/jquery-promises-and-exponential-backoff.html"
            },
            {
              name: "Playing around with Tableau Public",
              key: "1273340700771095944",
              title: "Playing around with Tableau Public",
              url:
                "http://excelramblings.blogspot.com/2013/06/playing-around-with-tableau-public.html"
            },
            {
              name: "Visualization of Sites to Tags with d3.js",
              key: "5607957530623178388",
              title: "Visualization of Sites to Tags with d3.js",
              url:
                "http://excelramblings.blogspot.com/2013/06/visualization-of-sites-to-tags-with-d3js.html"
            },
            {
              name: "Create biased random test data in VBA",
              key: "7694682231502772662",
              title: "Create biased random test data in VBA",
              url:
                "http://excelramblings.blogspot.com/2013/05/create-biased-random-test-data-in-vba.html"
            },
            {
              name: "Digest authentication and Google Apps Script",
              key: "1877368420429228536",
              title: "Digest authentication and Google Apps Script",
              url:
                "http://excelramblings.blogspot.com/2013/05/digest-authentication-and-google-apps.html"
            },
            {
              name: "Mashing up electoral data - follow on from oUseful post",
              key: "2877216136096344149",
              title: "Mashing up electoral data - follow on from oUseful post",
              url:
                "http://excelramblings.blogspot.com/2013/05/mashing-up-electoral-data-follow-on.html"
            },
            {
              name:
                "Finding nearest match and other palettes in other fixed color schemes",
              key: "8422077368465527413",
              title:
                "Finding nearest match and other palettes in other fixed color schemes",
              url:
                "http://excelramblings.blogspot.com/2013/04/finding-nearest-match-and-other.html"
            },
            {
              name: "Parse.com and ScriptDB performance comparison",
              key: "392424253892348032",
              title: "Parse.com and ScriptDB performance comparison",
              url:
                "http://excelramblings.blogspot.com/2013/04/parsecom-and-scriptdb-performance.html"
            },
            {
              name:
                "More playing around with color, parse.com, scriptDb and Google Apps Script",
              key: "2883844698086205263",
              title:
                "More playing around with color, parse.com, scriptDb and Google Apps Script",
              url:
                "http://excelramblings.blogspot.com/2013/04/more-playing-around-with-color-parsecom.html"
            },
            {
              name:
                "Very interesting GAS performance results - run locally using htmlservice",
              key: "7600185462534995089",
              title:
                "Very interesting GAS performance results - run locally using htmlservice",
              url:
                "http://excelramblings.blogspot.com/2013/04/very-interesting-gas-performance.html"
            },
            {
              name:
                "Executing Google Apps Script Code directly in javascript - GAS as a CDN",
              key: "8140234695385851924",
              title:
                "Executing Google Apps Script Code directly in javascript - GAS as a CDN",
              url:
                "http://excelramblings.blogspot.com/2013/04/executing-google-apps-script-code.html"
            },
            {
              name: 'Google Apps Script "execution time exceeded" woes',
              key: "113099679383588473",
              title: 'Google Apps Script "execution time exceeded" woes',
              url:
                "http://excelramblings.blogspot.com/2013/04/google-apps-script-execution-time.html"
            },
            {
              name: "Google Apps Script Color Space Conversions.",
              key: "9076157104544212088",
              title: "Google Apps Script Color Space Conversions.",
              url:
                "http://excelramblings.blogspot.com/2013/04/in-google-apps-script-color-functions.html"
            },
            {
              name:
                "Automatic documentation from VBA - including function arguments",
              key: "303434109958137808",
              title:
                "Automatic documentation from VBA - including function arguments",
              url:
                "http://excelramblings.blogspot.com/2013/03/automatic-documentation-from-vba.html"
            },
            {
              name: "Using jSon/javaScript like structures in VBA",
              key: "8274971709723588104",
              title: "Using jSon/javaScript like structures in VBA",
              url:
                "http://excelramblings.blogspot.com/2013/03/using-jsonjavascript-like-structures-in.html"
            },
            {
              name: "VBA procedures for CIE LabLch and HSL color scheming",
              key: "4885079350110396129",
              title: "VBA procedures for CIE LabLch and HSL color scheming",
              url:
                "http://excelramblings.blogspot.com/2013/03/vba-procedures-for-cie-lablch-and-hsl.html"
            },
            {
              name: "Inherit link colors from cells - D3 sankey from Excel",
              key: "726547650393306593",
              title: "Inherit link colors from cells - D3 sankey from Excel",
              url:
                "http://excelramblings.blogspot.com/2013/03/inherit-link-colors-from-cells-d3.html"
            },
            {
              name:
                "API of the Day: facebook fql direct from Excel and Google APPs",
              key: "5123811479853799614",
              title:
                "API of the Day: facebook fql direct from Excel and Google APPs",
              url:
                "http://excelramblings.blogspot.com/2013/02/api-of-day-facebook-fql-direct-from.html"
            },
            {
              name: "Using Google Cache to persist data across function calls",
              key: "5171309153881224161",
              title: "Using Google Cache to persist data across function calls",
              url:
                "http://excelramblings.blogspot.com/2012/11/using-google-cache-to-persist-data.html"
            },
            {
              name: "Google Apps Script Liberation - publishing your stuff",
              key: "1235082730654703426",
              title: "Google Apps Script Liberation - publishing your stuff",
              url:
                "http://excelramblings.blogspot.com/2012/11/google-apps-script-liberation.html"
            },
            {
              name: "Publishing Google Apps Script code snippets",
              key: "8509622422164774508",
              title: "Publishing Google Apps Script code snippets",
              url:
                "http://excelramblings.blogspot.com/2012/11/publishing-google-apps-script-code.html"
            },
            {
              name: "Google Apps Script - a new day - a new feature",
              key: "1277895260449630214",
              title: "Google Apps Script - a new day - a new feature",
              url:
                "http://excelramblings.blogspot.com/2012/11/google-apps-script-new-day-new-feature.html"
            },
            {
              name:
                "Delegating processing to the cloud from Excel and other plafforms",
              key: "5084915138686054565",
              title:
                "Delegating processing to the cloud from Excel and other plafforms",
              url:
                "http://excelramblings.blogspot.com/2012/11/delegating-processing-to-cloud-from.html"
            },
            {
              name:
                "Keeping all those Google Apps script 'shortcuts' under control",
              key: "5098197221478856945",
              title:
                "Keeping all those Google Apps script 'shortcuts' under control",
              url:
                "http://excelramblings.blogspot.com/2012/11/keeping-all-those-google-apps-script.html"
            },
            {
              name:
                "Somewhere to keep those API keys: google apps script rest library entry",
              key: "2496652094240262709",
              title:
                "Somewhere to keep those API keys: google apps script rest library entry",
              url:
                "http://excelramblings.blogspot.com/2012/10/somewhere-to-keep-those-api-keys-google.html"
            },
            {
              name:
                "API library entry of the day: use builtwith.com to see how websites are built",
              key: "3359858520667095768",
              title:
                "API library entry of the day: use builtwith.com to see how websites are built",
              url:
                "http://excelramblings.blogspot.com/2012/10/api-library-entry-of-day-use.html"
            },
            {
              name:
                "Shortening a string, but keeping it unique: Google Apps Script Caching Keys",
              key: "3738015269036481659",
              title:
                "Shortening a string, but keeping it unique: Google Apps Script Caching Keys",
              url:
                "http://excelramblings.blogspot.com/2012/10/shortening-string-but-keeping-it-unique.html"
            },
            {
              name: "Google Caching and faking jsonp ",
              key: "6818644533368943143",
              title: "Google Caching and faking jsonp ",
              url:
                "http://excelramblings.blogspot.com/2012/10/google-caching-and-faking-jsonp.html"
            },
            {
              name:
                "Is Microsoft's Office and Windows makeover another stairway to nowhere?",
              key: "188276158587452046",
              title:
                "Is Microsoft's Office and Windows makeover another stairway to nowhere?",
              url:
                "http://excelramblings.blogspot.com/2012/10/is-microsofts-office-and-windows.html"
            },
            {
              name: "Batman plot in Excel",
              key: "5658550406568981102",
              title: "Batman plot in Excel",
              url:
                "http://excelramblings.blogspot.com/2012/10/batman-plot-in-excel.html"
            },
            {
              name: "Plotting equations in Excel",
              key: "1818756011967663323",
              title: "Plotting equations in Excel",
              url:
                "http://excelramblings.blogspot.com/2012/10/plotting-equations-in-excel.html"
            },
            {
              name:
                "Storing and serving up images from scriptDB with Google Content Service, jSonP and jQuery",
              key: "2636991496542940917",
              title:
                "Storing and serving up images from scriptDB with Google Content Service, jSonP and jQuery",
              url:
                "http://excelramblings.blogspot.com/2012/10/storing-and-serving-up-images-from.html"
            },
            {
              name: "Transforming data for d3 tree",
              key: "5274580566090877085",
              title: "Transforming data for d3 tree",
              url:
                "http://excelramblings.blogspot.com/2012/10/transforming-data-for-d3-tree.html"
            },
            {
              name: "Urbarama API mashup - The daily rest library API",
              key: "3875856646580320367",
              title: "Urbarama API mashup - The daily rest library API",
              url:
                "http://excelramblings.blogspot.com/2012/10/urbarama-api-mashup-daily-rest-library.html"
            },
            {
              name: "Client oAuth calls using a Google Apps scriptDB lockbox",
              key: "465844765155900870",
              title: "Client oAuth calls using a Google Apps scriptDB lockbox",
              url:
                "http://excelramblings.blogspot.com/2012/09/client-oauth-calls-using-google-apps.html"
            },
            {
              name: "using Google Apps ScriptDB as a lockBox",
              key: "2655798802137983396",
              title: "using Google Apps ScriptDB as a lockBox",
              url:
                "http://excelramblings.blogspot.com/2012/09/using-google-apps-scriptdb-as-lockbox.html"
            },
            {
              name:
                "scraperWiki API: The Daily REST library entry for Excel and GAScript ",
              key: "6575351954668085367",
              title:
                "scraperWiki API: The Daily REST library entry for Excel and GAScript ",
              url:
                "http://excelramblings.blogspot.com/2012/09/scraperwiki-api-daily-rest-library.html"
            },
            {
              name:
                "Yahoo Geocoding API: The Daily REST library entry for Excel and GAScript",
              key: "1042050952602012497",
              title:
                "Yahoo Geocoding API: The Daily REST library entry for Excel and GAScript",
              url:
                "http://excelramblings.blogspot.com/2012/08/yahoo-geocoding-api-daily-rest-library.html"
            },
            {
              name: "Huffington Post polls results directly into Excel",
              key: "9112008716467836477",
              title: "Huffington Post polls results directly into Excel",
              url:
                "http://excelramblings.blogspot.com/2012/07/huffington-post-polls-results-directly.html"
            },
            {
              name: "jSon data for all F1 races straight into Excel",
              key: "4618409928727957547",
              title: "jSon data for all F1 races straight into Excel",
              url:
                "http://excelramblings.blogspot.com/2012/04/json-data-for-all-f1-races-straight.html"
            },
            {
              name: "Retrieving data from Google Books",
              key: "403824494454135253",
              title: "Retrieving data from Google Books",
              url:
                "http://excelramblings.blogspot.com/2011/08/retrieving-data-from-google-books.html"
            }
          ]
        },
        {
          name: "async",
          count: 55,
          key: "async",
          pages: [
            {
              name:
                "How many requests a second can you throw at your Google Apps Script webapp",
              key: "4922729785237290749",
              title:
                "How many requests a second can you throw at your Google Apps Script webapp",
              url:
                "http://excelramblings.blogspot.com/2014/09/how-many-requests-second-can-you-throw.html"
            },
            {
              name:
                "Parse.com as a substitute for ScriptDB in Google Apps Script",
              key: "7001401762815725863",
              title:
                "Parse.com as a substitute for ScriptDB in Google Apps Script",
              url:
                "http://excelramblings.blogspot.com/2014/05/parsecom-as-substitute-for-scriptdb-in.html"
            },
            {
              name:
                "Eurovision song contest voting oddities - interactive visualization",
              key: "3387730798287808432",
              title:
                "Eurovision song contest voting oddities - interactive visualization",
              url:
                "http://excelramblings.blogspot.com/2014/05/eurovision-song-contest-voting-oddities.html"
            },
            {
              name: "Dealing with Unix timestamps in Excel",
              key: "3060013286872872681",
              title: "Dealing with Unix timestamps in Excel",
              url:
                "http://excelramblings.blogspot.com/2013/12/dealing-with-unix-timestamps-in-excel.html"
            },
            {
              name: "Tracking your Excel Workbooks with Google Analytics",
              key: "8719756569439397730",
              title: "Tracking your Excel Workbooks with Google Analytics",
              url:
                "http://excelramblings.blogspot.com/2013/11/tracking-your-excel-workbooks-with.html"
            },
            {
              name: "Mitigating for changes in REST API rules and formats",
              key: "6535599039394459349",
              title: "Mitigating for changes in REST API rules and formats",
              url:
                "http://excelramblings.blogspot.com/2013/11/mitigating-for-changes-in-rest-api.html"
            },
            {
              name: "XML and JSON conversion in VBA ",
              key: "8631701126612541596",
              title: "XML and JSON conversion in VBA ",
              url:
                "http://excelramblings.blogspot.com/2013/10/xml-and-json-conversion-in-vba.html"
            },
            {
              name:
                "REST access to list management cloud based functions - plus a VBA example",
              key: "9125639579444215862",
              title:
                "REST access to list management cloud based functions - plus a VBA example",
              url:
                "http://excelramblings.blogspot.com/2013/09/rest-access-to-list-management-cloud.html"
            },
            {
              name: "What does Google Autocomplete show all over the world ?",
              key: "8388159511072830347",
              title: "What does Google Autocomplete show all over the world ?",
              url:
                "http://excelramblings.blogspot.com/2013/08/what-does-google-autocomplete-show-all.html"
            },
            {
              name: "Google Docs to Excel Asynchronously",
              key: "6143895170557586170",
              title: "Google Docs to Excel Asynchronously",
              url:
                "http://excelramblings.blogspot.com/2013/08/google-docs-to-excel-asynchronously.html"
            },
            {
              name:
                "Using ScriptDB as a noSQL database for non-Google Apps Script clients",
              key: "4984756556960647894",
              title:
                "Using ScriptDB as a noSQL database for non-Google Apps Script clients",
              url:
                "http://excelramblings.blogspot.com/2013/07/using-scriptdb-as-nosql-database-for.html"
            },
            {
              name: "Concept browser for site navigation with d3",
              key: "2591807608450374884",
              title: "Concept browser for site navigation with d3",
              url:
                "http://excelramblings.blogspot.com/2013/07/concept-browser-for-site-navigation.html"
            },
            {
              name: "Sankey diagrams direct from Excel - update",
              key: "7899286130266944386",
              title: "Sankey diagrams direct from Excel - update",
              url:
                "http://excelramblings.blogspot.com/2013/07/sankey-diagrams-direct-from-excel-update.html"
            },
            {
              name:
                "Exploring blogs and sites by d3 tag visualization and effect on site visits",
              key: "7778365833610693391",
              title:
                "Exploring blogs and sites by d3 tag visualization and effect on site visits",
              url:
                "http://excelramblings.blogspot.com/2013/06/exploring-blogs-and-sites-by-d3-tag.html"
            },
            {
              name:
                "Google Fusion Big Data and D3 integration: flight data visualization",
              key: "8192496343933999913",
              title:
                "Google Fusion Big Data and D3 integration: flight data visualization",
              url:
                "http://excelramblings.blogspot.com/2013/06/google-fusion-big-data-and-d3.html"
            },
            {
              name: "jQuery promises and exponential backoff",
              key: "9187220054075379583",
              title: "jQuery promises and exponential backoff",
              url:
                "http://excelramblings.blogspot.com/2013/06/jquery-promises-and-exponential-backoff.html"
            },
            {
              name: "Playing around with Tableau Public",
              key: "1273340700771095944",
              title: "Playing around with Tableau Public",
              url:
                "http://excelramblings.blogspot.com/2013/06/playing-around-with-tableau-public.html"
            },
            {
              name: "Visualization of Sites to Tags with d3.js",
              key: "5607957530623178388",
              title: "Visualization of Sites to Tags with d3.js",
              url:
                "http://excelramblings.blogspot.com/2013/06/visualization-of-sites-to-tags-with-d3js.html"
            },
            {
              name: "Create biased random test data in VBA",
              key: "7694682231502772662",
              title: "Create biased random test data in VBA",
              url:
                "http://excelramblings.blogspot.com/2013/05/create-biased-random-test-data-in-vba.html"
            },
            {
              name: "Digest authentication and Google Apps Script",
              key: "1877368420429228536",
              title: "Digest authentication and Google Apps Script",
              url:
                "http://excelramblings.blogspot.com/2013/05/digest-authentication-and-google-apps.html"
            },
            {
              name: "Mashing up electoral data - follow on from oUseful post",
              key: "2877216136096344149",
              title: "Mashing up electoral data - follow on from oUseful post",
              url:
                "http://excelramblings.blogspot.com/2013/05/mashing-up-electoral-data-follow-on.html"
            },
            {
              name:
                "Finding nearest match and other palettes in other fixed color schemes",
              key: "8422077368465527413",
              title:
                "Finding nearest match and other palettes in other fixed color schemes",
              url:
                "http://excelramblings.blogspot.com/2013/04/finding-nearest-match-and-other.html"
            },
            {
              name: "Parse.com and ScriptDB performance comparison",
              key: "392424253892348032",
              title: "Parse.com and ScriptDB performance comparison",
              url:
                "http://excelramblings.blogspot.com/2013/04/parsecom-and-scriptdb-performance.html"
            },
            {
              name:
                "More playing around with color, parse.com, scriptDb and Google Apps Script",
              key: "2883844698086205263",
              title:
                "More playing around with color, parse.com, scriptDb and Google Apps Script",
              url:
                "http://excelramblings.blogspot.com/2013/04/more-playing-around-with-color-parsecom.html"
            },
            {
              name:
                "Very interesting GAS performance results - run locally using htmlservice",
              key: "7600185462534995089",
              title:
                "Very interesting GAS performance results - run locally using htmlservice",
              url:
                "http://excelramblings.blogspot.com/2013/04/very-interesting-gas-performance.html"
            },
            {
              name:
                "Executing Google Apps Script Code directly in javascript - GAS as a CDN",
              key: "8140234695385851924",
              title:
                "Executing Google Apps Script Code directly in javascript - GAS as a CDN",
              url:
                "http://excelramblings.blogspot.com/2013/04/executing-google-apps-script-code.html"
            },
            {
              name: 'Google Apps Script "execution time exceeded" woes',
              key: "113099679383588473",
              title: 'Google Apps Script "execution time exceeded" woes',
              url:
                "http://excelramblings.blogspot.com/2013/04/google-apps-script-execution-time.html"
            },
            {
              name: "Google Apps Script Color Space Conversions.",
              key: "9076157104544212088",
              title: "Google Apps Script Color Space Conversions.",
              url:
                "http://excelramblings.blogspot.com/2013/04/in-google-apps-script-color-functions.html"
            },
            {
              name:
                "Automatic documentation from VBA - including function arguments",
              key: "303434109958137808",
              title:
                "Automatic documentation from VBA - including function arguments",
              url:
                "http://excelramblings.blogspot.com/2013/03/automatic-documentation-from-vba.html"
            },
            {
              name: "Using jSon/javaScript like structures in VBA",
              key: "8274971709723588104",
              title: "Using jSon/javaScript like structures in VBA",
              url:
                "http://excelramblings.blogspot.com/2013/03/using-jsonjavascript-like-structures-in.html"
            },
            {
              name: "VBA procedures for CIE LabLch and HSL color scheming",
              key: "4885079350110396129",
              title: "VBA procedures for CIE LabLch and HSL color scheming",
              url:
                "http://excelramblings.blogspot.com/2013/03/vba-procedures-for-cie-lablch-and-hsl.html"
            },
            {
              name: "Inherit link colors from cells - D3 sankey from Excel",
              key: "726547650393306593",
              title: "Inherit link colors from cells - D3 sankey from Excel",
              url:
                "http://excelramblings.blogspot.com/2013/03/inherit-link-colors-from-cells-d3.html"
            },
            {
              name:
                "API of the Day: facebook fql direct from Excel and Google APPs",
              key: "5123811479853799614",
              title:
                "API of the Day: facebook fql direct from Excel and Google APPs",
              url:
                "http://excelramblings.blogspot.com/2013/02/api-of-day-facebook-fql-direct-from.html"
            },
            {
              name:
                "GAS openbadges infrastructure - playing around with images and promises",
              key: "1688169144459314238",
              title:
                "GAS openbadges infrastructure - playing around with images and promises",
              url:
                "http://excelramblings.blogspot.com/2013/02/gas-openbadges-infrastructure-playing.html"
            },
            {
              name: "Using Google Cache to persist data across function calls",
              key: "5171309153881224161",
              title: "Using Google Cache to persist data across function calls",
              url:
                "http://excelramblings.blogspot.com/2012/11/using-google-cache-to-persist-data.html"
            },
            {
              name: "Google Apps Script Liberation - publishing your stuff",
              key: "1235082730654703426",
              title: "Google Apps Script Liberation - publishing your stuff",
              url:
                "http://excelramblings.blogspot.com/2012/11/google-apps-script-liberation.html"
            },
            {
              name: "Publishing Google Apps Script code snippets",
              key: "8509622422164774508",
              title: "Publishing Google Apps Script code snippets",
              url:
                "http://excelramblings.blogspot.com/2012/11/publishing-google-apps-script-code.html"
            },
            {
              name: "Google Apps Script - a new day - a new feature",
              key: "1277895260449630214",
              title: "Google Apps Script - a new day - a new feature",
              url:
                "http://excelramblings.blogspot.com/2012/11/google-apps-script-new-day-new-feature.html"
            },
            {
              name:
                "Delegating processing to the cloud from Excel and other plafforms",
              key: "5084915138686054565",
              title:
                "Delegating processing to the cloud from Excel and other plafforms",
              url:
                "http://excelramblings.blogspot.com/2012/11/delegating-processing-to-cloud-from.html"
            },
            {
              name:
                "Keeping all those Google Apps script 'shortcuts' under control",
              key: "5098197221478856945",
              title:
                "Keeping all those Google Apps script 'shortcuts' under control",
              url:
                "http://excelramblings.blogspot.com/2012/11/keeping-all-those-google-apps-script.html"
            },
            {
              name:
                "Somewhere to keep those API keys: google apps script rest library entry",
              key: "2496652094240262709",
              title:
                "Somewhere to keep those API keys: google apps script rest library entry",
              url:
                "http://excelramblings.blogspot.com/2012/10/somewhere-to-keep-those-api-keys-google.html"
            },
            {
              name:
                "API library entry of the day: use builtwith.com to see how websites are built",
              key: "3359858520667095768",
              title:
                "API library entry of the day: use builtwith.com to see how websites are built",
              url:
                "http://excelramblings.blogspot.com/2012/10/api-library-entry-of-day-use.html"
            },
            {
              name:
                "Shortening a string, but keeping it unique: Google Apps Script Caching Keys",
              key: "3738015269036481659",
              title:
                "Shortening a string, but keeping it unique: Google Apps Script Caching Keys",
              url:
                "http://excelramblings.blogspot.com/2012/10/shortening-string-but-keeping-it-unique.html"
            },
            {
              name: "Google Caching and faking jsonp ",
              key: "6818644533368943143",
              title: "Google Caching and faking jsonp ",
              url:
                "http://excelramblings.blogspot.com/2012/10/google-caching-and-faking-jsonp.html"
            },
            {
              name:
                "Is Microsoft's Office and Windows makeover another stairway to nowhere?",
              key: "188276158587452046",
              title:
                "Is Microsoft's Office and Windows makeover another stairway to nowhere?",
              url:
                "http://excelramblings.blogspot.com/2012/10/is-microsofts-office-and-windows.html"
            },
            {
              name: "Batman plot in Excel",
              key: "5658550406568981102",
              title: "Batman plot in Excel",
              url:
                "http://excelramblings.blogspot.com/2012/10/batman-plot-in-excel.html"
            },
            {
              name: "Plotting equations in Excel",
              key: "1818756011967663323",
              title: "Plotting equations in Excel",
              url:
                "http://excelramblings.blogspot.com/2012/10/plotting-equations-in-excel.html"
            },
            {
              name:
                "Storing and serving up images from scriptDB with Google Content Service, jSonP and jQuery",
              key: "2636991496542940917",
              title:
                "Storing and serving up images from scriptDB with Google Content Service, jSonP and jQuery",
              url:
                "http://excelramblings.blogspot.com/2012/10/storing-and-serving-up-images-from.html"
            },
            {
              name: "Transforming data for d3 tree",
              key: "5274580566090877085",
              title: "Transforming data for d3 tree",
              url:
                "http://excelramblings.blogspot.com/2012/10/transforming-data-for-d3-tree.html"
            }
          ]
        }
      ];

      function getTheData(control) {
        var dataPromise = mydata;
        var massage = $.Deferred();
        /*   dataPromise
          .done(function(data) { */
        // need to massage it
        massage.resolve(dataMassage(control, mydata));
        /*    })
          .fail(function(error) {
            console.log(error);
            massage.reject(error);
          }); */
        return massage.promise();
      }

      function dataMassage(control, data) {
        var ind = data,
          nodes = [],
          links = [];
        // the tags are to be circles
        for (var i = 0; i < ind.length; i++) {
          ind[i].isCurrentlyFocused = false;
          nodes.push(ind[i]);
          // add links to pages
          for (var j = 0; j < ind[i].pages.length; j++) {
            //push this page as a node
            var node = findOrAddPage(control, ind[i].pages[j], nodes);
            node.isCurrentlyFocused = false;
            // create a link
            var link = {
              source: node,
              target: ind[i],
              key: node.key + "_" + ind[i].key
            };
            links.push(link);
          }
        }
        // sort nodes alpha
        nodes.sort(function(a, b) {
          return a.name < b.name ? -1 : a.name == b.name ? 0 : 1;
        });
        control.pageCount = 0;
        control.pageRectSize = { width: 0, height: 0, radius: 0 };
        for (var i = 0; i < nodes.length; i++) {
          page = nodes[i];
          page.group = 0;
          page.dim = getPixelDims(control.scratch, page.name);
          if (page.fixed) {
            control.pageCount++;
            // this will calculate the width/height in pixels of the largest label
            control.pageRectSize.width = Math.max(
              control.pageRectSize.width,
              page.dim.width
            );
            control.pageRectSize.height = Math.max(
              control.pageRectSize.height,
              page.dim.height
            );
            control.pageRectSize.radius = Math.max(
              control.pageRectSize.radius,
              makeRadius(control, page)
            );
            page.group = 1;
          }
        }
        var options = control.options;

        // we're going to fix the nodes that are pages into two columns
        for (var i = 0, c = 0; i < nodes.length; i++) {
          var page = nodes[i];
          if (page.fixed) {
            page.right = c > control.pageCount / 2;
            // y dimension calc same for each column
            page.y =
              ((c % (control.pageCount / 2)) + 0.5) *
              control.pageRectSize.height;

            // x based on right or left column
            page.x = page.right
              ? control.width - control.pageRectSize.width - options.labelOffset
              : page.dim.width + options.labelOffset;
            c++;
          }
        }

        return { nodes: nodes, links: links };
      }

      function findOrAddPage(control, page, nodes) {
        for (var i = 0; i < nodes.length; i++) {
          if (nodes[i].key === page.key) {
            nodes[i].count++;
            return nodes[i];
          }
        }
        page.fixed = true;
        page.count = 0;
        return nodes[nodes.push(page) - 1];
      }

      // modify with your proxy and dataurl
      // take the raw data and prepare it for d3
      function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
          results = regex.exec(location.search);
        return results == null
          ? ""
          : decodeURIComponent(results[1].replace(/\+/g, " "));
      }
      // modify with your proxy and dataurl
      // take the raw data and prepare it for d3
      function getTheRawData() {
        // here's a php proxy to make jsonP
        var proxyUrl =
          "https://script.google.com/macros/s/AKfycbzMhwJy-OAR28YTBxO1AbVdSQQFI101X3UDzY-1yc9lUgBfpSc/exec";

        // blogwheel.json - blog only
        // sitewheel.json - both
        // allwheel.json - site

        var dataUrl =
          getParameterByName("data") ||
          "https://storage.googleapis.com/xliberation.com/dump/blogwheel.json";

        // promise will be resolved when done
        return getPromiseData(dataUrl, proxyUrl);
      }

      // no need to touch this
      // general deferred handler for getting json data through proxy and creating promise
      function getPromiseData(url, proxyUrl) {
        var deferred = $.Deferred();
        var u = proxyUrl + "?url=" + encodeURIComponent(url);

        $.getJSON(u, null, function(data) {
          if (Math.floor(data.responseCode / 100) !== 2) {
            throw "error " + data.responseCode + " getting data " + data.result;
          }
          // data returned by apps script proxy is encoded json.
          deferred.resolve(JSON.parse(data.result));
        }).error(function(res, status, err) {
          deferred.reject("error " + err + " for " + url);
        });

        return deferred.promise();
      }
    </script>
  </head>
  <body>
    <div id="chart"></div>
  </body>
</html>
